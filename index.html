<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Oro - Negociaci√≥n</title>
    <style>
        body { font-family: 'Segoe UI', Roboto, sans-serif; background-color: #f8f9fa; margin: 0; padding: 15px; display: flex; justify-content: center; }
        .container { background: white; width: 100%; max-width: 450px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); overflow: hidden; }
        
        /* Header Compacto */
        .header { background: #343a40; color: #ffd43b; padding: 15px; text-align: center; }
        .header h2 { margin: 0; font-size: 20px; text-transform: uppercase; }

        .content { padding: 15px; }

        /* Inputs */
        label { font-weight: bold; color: #495057; display: block; margin-top: 10px; margin-bottom: 5px; font-size: 14px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 8px; font-size: 18px; text-align: center; box-sizing: border-box; }
        input:focus { border-color: #ffd43b; outline: none; border-width: 2px; }

        /* Switch Precio */
        .price-toggle { display: flex; gap: 5px; margin-bottom: 5px; }
        .price-toggle label { flex: 1; background: #e9ecef; padding: 10px; text-align: center; border-radius: 6px; cursor: pointer; font-size: 13px; margin: 0; transition: 0.2s; border: 1px solid transparent; }
        input[type="radio"] { display: none; }
        input[type="radio"]:checked + label { background-color: #228be6; color: white; font-weight: bold; border-color: #1864ab; }

        /* CAJA M√ÅGICA DE REFERENCIAS (EL CHISMOSO) */
        .ref-box { background-color: #e7f5ff; border: 1px solid #74c0fc; border-radius: 8px; padding: 10px; margin-top: 10px; display: none; }
        .ref-title { font-size: 11px; color: #1c7ed6; text-transform: uppercase; font-weight: bold; text-align: center; margin-bottom: 5px; }
        .ref-grid { display: flex; justify-content: space-around; text-align: center; }
        .ref-item span { display: block; font-size: 12px; color: #555; }
        .ref-item strong { display: block; font-size: 16px; color: #1864ab; }

        /* Resultados Grandes */
        .results { background-color: #fff9db; border: 2px solid #fcc419; border-radius: 10px; padding: 15px; margin-top: 20px; }
        .res-info { display: flex; justify-content: space-between; font-size: 14px; color: #555; margin-bottom: 5px; border-bottom: 1px solid #fae3b5; padding-bottom: 5px; }
        .total-pay { font-size: 32px; font-weight: 800; color: #212529; text-align: center; display: block; margin-top: 5px; }
        .total-label { text-align: center; display: block; font-size: 12px; color: #868e96; text-transform: uppercase; }

        /* Botones */
        .btn-group { display: flex; gap: 8px; margin-top: 20px; }
        button { padding: 12px; border: none; border-radius: 6px; font-weight: bold; color: white; cursor: pointer; font-size: 15px; }
        .btn-cls { background: #fa5252; width: 30%; }
        .btn-save { background: #40c057; width: 70%; }

        /* Historial */
        .history { margin-top: 25px; border-top: 1px dashed #ced4da; padding-top: 10px; }
        .history h4 { font-size: 12px; color: #adb5bd; text-align: center; margin: 0 0 10px 0; }
        ul { list-style: none; padding: 0; margin: 0; }
        li { background: white; padding: 8px 12px; margin-bottom: 6px; border-radius: 6px; font-size: 13px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid #228be6; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>üí∞ Calculadora de Oro</h2>
    </div>

    <div class="content">
        <label>‚öñÔ∏è PESO (Gramos):</label>
        <input type="number" id="gramos" placeholder="0.00" step="0.01" inputmode="decimal" oninput="calcular()">

        <label>üè∑Ô∏è LEY / CALIDAD:</label>
        <select id="ley">
            <option value="Fundido">Oro Fundido</option>
            <option value="Ley 900">Ley 900</option>
            <option value="Ley 875">Ley 875</option>
            <option value="Ley 750">Ley 750 (18k)</option>
            <option value="Chatarra">Chatarra</option>
        </select>

        <label>ü§ù PRECIO A PAGAR:</label>
        <div class="price-toggle">
            <input type="radio" id="pGramo" name="modo" value="gramo" checked onchange="calcular()">
            <label for="pGramo">Por GRAMO</label>

            <input type="radio" id="pCastellano" name="modo" value="castellano" onchange="calcular()">
            <label for="pCastellano">Por CASTELLANO</label>
        </div>
        <input type="number" id="precio" placeholder="$ Precio Negociado..." inputmode="numeric" oninput="calcular()">

        <div class="ref-box" id="cajaReferencias">
            <div class="ref-title">‚ÑπÔ∏è A este precio est√°s pagando:</div>
            <div class="ref-grid">
                <div class="ref-item">
                    <span>El Real a:</span>
                    <strong id="refReal">$0</strong>
                </div>
                <div class="ref-item">
                    <span>El Cast. a:</span>
                    <strong id="refCast">$0</strong>
                </div>
                <div class="ref-item">
                    <span>El Gramo a:</span>
                    <strong id="refGramo">$0</strong>
                </div>
            </div>
        </div>

        <div class="results">
            <div class="res-info">
                <span>üì¶ Castellanos: <b id="valCast">0.00</b></span>
                <span>üíé Reales: <b id="valReales">0.00</b></span>
            </div>
            <span class="total-label">Total a Entregar al Cliente:</span>
            <span class="total-pay" id="valTotal">$0</span>
        </div>

        <div class="btn-group">
            <button class="btn-cls" onclick="borrar()">Borrar</button>
            <button class="btn-save" onclick="guardar()">Guardar</button>
        </div>

        <div class="history">
            <h4>üìù √öltimos Negocios</h4>
            <ul id="lista"></ul>
        </div>
    </div>
</div>

<script>
    function calcular() {
        let gramos = parseFloat(document.getElementById('gramos').value) || 0;
        let precio = parseFloat(document.getElementById('precio').value) || 0;
        let modo = document.querySelector('input[name="modo"]:checked').value;
        let cajaRef = document.getElementById('cajaReferencias');

        // 1. Calcular Cantidades
        let castellanos = gramos / 4.6;
        let reales = castellanos * 16; // O gramos / 0.2875

        // 2. Calcular Totales y Referencias
        let total = 0;
        let precioPorReal = 0;
        let precioPorCast = 0;
        let precioPorGramo = 0;

        if (precio > 0) {
            cajaRef.style.display = 'block'; // Mostrar la caja azul
            
            if (modo === 'gramo') {
                // Negoci√≥ por Gramo
                total = gramos * precio;
                precioPorGramo = precio;
                precioPorCast = precio * 4.6; 
                precioPorReal = precio * 0.2875; // La magia del 0.2875
            } else {
                // Negoci√≥ por Castellano
                total = castellanos * precio;
                precioPorCast = precio;
                precioPorReal = precio / 16;
                precioPorGramo = precio / 4.6;
            }
        } else {
            cajaRef.style.display = 'none'; // Ocultar si no hay precio
        }

        // 3. Renderizar en Pantalla
        document.getElementById('valCast').innerText = castellanos.toFixed(4);
        document.getElementById('valReales').innerText = reales.toFixed(2);
        document.getElementById('valTotal').innerText = moneda(total);

        // Renderizar Referencias (El Chismoso)
        document.getElementById('refReal').innerText = moneda(precioPorReal);
        document.getElementById('refCast').innerText = moneda(precioPorCast);
        document.getElementById('refGramo').innerText = moneda(precioPorGramo);
    }

    function moneda(valor) {
        return new Intl.NumberFormat('es-CO', { 
            style: 'currency', currency: 'COP', maximumFractionDigits: 0 
        }).format(valor);
    }

    function borrar() {
        document.getElementById('gramos').value = '';
        document.getElementById('precio').value = '';
        document.getElementById('cajaReferencias').style.display = 'none';
        document.getElementById('valCast').innerText = '0.00';
        document.getElementById('valReales').innerText = '0.00';
        document.getElementById('valTotal').innerText = '$0';
        document.getElementById('gramos').focus();
    }

    function guardar() {
        let total = document.getElementById('valTotal').innerText;
        if(total === '$0') return;

        let gramos = document.getElementById('gramos').value;
        let ley = document.getElementById('ley').value;
        let lista = document.getElementById('lista');
        let item = document.createElement('li');
        let hora = new Date().toLocaleTimeString('es-CO', {hour: '2-digit', minute:'2-digit'});

        item.innerHTML = `<span><strong>${hora}</strong> ${gramos}g (${ley})</span> <strong>${total}</strong>`;
        
        lista.insertBefore(item, lista.firstChild);
        if(lista.children.length > 8) lista.removeChild(lista.lastChild);
    }
</script>

</body>
</html>